///////////////////////////////// Content area /////////////////////////////////
#gallery-content {
  width: 100%;
  height: 100%;
  overflow: hidden;
}

// WIP > better general thumbsize. See if we kind find better size ratio for different screensize.
// We'll have less loss of space perhaps
.thumbnail-small {
  --thumbnail-size: 160px;
}
.thumbnail-medium {
  --thumbnail-size: 240px;
}
.thumbnail-large {
  --thumbnail-size: 320px;
}

/////////////////////// Thumbnail //////////////////////////////////
// If selected, and any other selected image is a drop target: normal yellow border
// (as an indication that dropping a tag will apply it to all selected files)
#gallery-content[data-selected-file-dropping='true'] {
  .masonry {
    [aria-selected='true'] > .thumbnail {
      background-color: var(--accent-color-yellow);
    }
  }

  .list [aria-selected='true'] {
    background-color: rgba(255, 193, 47, 0.3);
  }
}

.thumbnail {
  display: flex;
  grid-area: image;
  width: var(--thumbnail-size);
  height: var(--thumbnail-size);
  // Allow dragging of images to elsewhere (drag-export)
  -webkit-user-drag: element;
  background-color: var(--background-color-alt);
  border: 0.0625rem solid var(--border-dark);
  border-radius: 0.25rem;

  transition: background-color 0.2s $pt-transition-cubic2;

  // This acts as the border-radius, but also for child elements
  :first-child {
    clip-path: inset(0 round 0.125rem);
    transition: clip-path 0.2s $pt-transition-cubic2;
    pointer-events: none;
  }

  > img {
    width: 100%;
    height: 100%;
    cursor: pointer;
    margin-left: auto;
    margin-right: auto;
    display: block;
    border-radius: 0.25rem;
  }

  &[data-dnd-target='true'] {
    background-color: var(--accent-color-yellow);

    img {
      clip-path: inset(0.5rem round 0.125rem);
    }
  }
}

[aria-selected='true'] > .thumbnail {
  // If selected, show a blue border
  background-color: var(--accent-color-blue);
  > img,
  > .image-error {
    clip-path: inset(0.25rem round 0.125rem); // old design
  }

  // If selected AND drop target: big yellow border
  &[data-dnd-target='true'] {
    background-color: var(--accent-color-yellow);
    > img,
    > .image-error {
      clip-path: inset(0.5rem round 0.125rem);
    }
  }

  > .image-error {
    border: 0.25rem solid var(--accent-color-red); // new design
  }
}

.thumbnail-broken {
  > img,
  > .image-error:not(.custom-icon-128) {
    filter: saturate(0) brightness(0.25);
  }
}

.thumbnail-broken-overlay {
  cursor: pointer;
  position: absolute;
  padding: 0.25rem;
  width: 2rem;
  height: 2rem;
  top: 0.5rem;
  right: 0.5rem;
  color: var(--accent-color-red) !important;

  svg {
    width: 1.5rem !important;
    height: 1.5rem !important;
  }
}

.image-error {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  height: 100%;
  width: 100%;
}

// THUMBNAIL LOADER
.donut-loading {
  display: inline-block;
  width: calc(0.3 * var(--thumbnail-size));
  height: calc(0.3 * var(--thumbnail-size));
  margin: auto;
  border-radius: 50%;
  border: 0.5rem solid var(--background-color);
  border-top-color: var(--accent-color-blue);
  animation: 1.5s spin infinite linear;
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

/////////////////////// View methods //////////////////////////////////
.list {
  top: 24px; // space for header

  // Stripe pattern
  [aria-rowindex$='0'],
  [aria-rowindex$='2'],
  [aria-rowindex$='4'],
  [aria-rowindex$='6'],
  [aria-rowindex$='8'] {
    background-color: rgba(102, 102, 102, 0.045);
  }

  // Allow horizontal scroll in list view
  > div {
    min-width: 600px;
    overflow-x: auto;
  }

  [role='gridcell'] {
    height: 24px;

    > div {
      // cell container
      height: 24px;
      display: inline-flex;
      align-items: center;
      vertical-align: middle;
      text-overflow: ellipsis;
      white-space: nowrap;
      padding: 0 4px;

      // Column widths:
      // - base width of 140px
      width: 140px;
      &:nth-child(2) {
        width: 90px;
      }
      &:nth-child(3) {
        width: 150px;
      }
      &:nth-child(4) {
        width: 80px;
      }
      // - first and last column (filename and tags): fill rest of width
      &:first-child,
      &:last-child {
        // both are 50% minus half of the rest of the columns (0.5 * 3 * 120)
        width: calc(50% - 160px);
      }

      // Overflow is needed for the first child for allowing the thumbnail to expand on hover
      &:not(:first-child) {
        overflow: hidden;
      }

      > .filename {
        display: inline;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: calc(100% - 32px); // minus thumbnail and some padding
        margin-left: 8px;
      }

      .thumbnail-broken {
        overflow: hidden;
      }
      .image-error {
        display: none;
      }
    }

    &[aria-selected='true'] {
      background-color: var(--accent-color-blue);
      color: white;
    }

    &[data-dnd-target='true'] {
      // Yellow background when DnD target
      background-color: rgba(255, 193, 47, 0.6) !important;
    }
  }

  // Force thumbnail size of 24 pixels
  --thumbnail-size: 20px;

  .thumbnail {
    align-self: center;
    display: inline-block;
    margin: 2px 0px 2px 4px;

    img {
      transition: transform 0.2s ease;
      transform-origin: top left;
      border-radius: 0;
    }

    &:hover {
      img {
        z-index: 2;
        position: relative;
        clip-path: inset(0);

        // show image in original aspect ratio, aligned to the left
        object-fit: contain;
        object-position: left;
        // a drop shadow might be nice too
      }
    }
  }

  // Last 4
  [role='row']:nth-last-child(-n + 4) .thumbnail:hover {
    img {
      transform: scale(10) translate(3px, -80%);
    }
  }
  // 4 > last 4
  [role='row']:nth-last-child(n + 5) .thumbnail:hover {
    img {
      transform: scale(10) translate(3px, -50%);
    }
  }

  // First 4
  [role='row']:nth-child(-n + 5) .thumbnail:hover {
    img {
      transform: scale(10) translate(3px, 0%);
    }
  }

  h2 {
    grid-area: title;
    font-size: medium;
    margin: 0;
    white-space: nowrap;
    align-self: end;
  }

  .thumbnail-tags {
    min-height: 1.5rem;
    position: unset;
    padding: 0;
  }
}

.list-header {
  height: 24px;
  width: 100%;
  border-bottom: 0.0625rem solid var(--border-color);

  // Same as content
  min-width: 600px;

  > div {
    // Column widths:
    // - base width of 140px
    width: 140px;
    &:nth-child(2) {
      width: 90px;
    }
    &:nth-child(3) {
      width: 150px;
    }
    &:nth-child(4) {
      width: 80px;
    }
    &:first-child {
      padding-left: 8px;
    }
    // - first and last column (filename and tags): fill rest of width
    &:first-child,
    &:last-child {
      // both are 50% minus half of the rest of the columns (0.5 * 3 * 120)
      width: calc(50% - 160px);
    }

    padding: 4px 4px 4px 4px;
    font-weight: bold;
    overflow: hidden;

    display: inline-flex;
    justify-content: space-between;

    &.sortable {
      cursor: pointer;
    }
  }
}

.thumbnail-small .list .file-info {
  border-spacing: 0;
}

.thumbnail-square img {
  background-position: center;
  object-fit: cover;
}
.thumbnail-letterbox img {
  object-fit: contain;
}

///////////////////////////
// Slide mode:
#slide-mode {
  flex-direction: row-reverse;

  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;

  background: var(--background-color);

  @keyframes fade-in-bg {
    from {
      background: rgba(var(--background-color), 0);
    }
    to {
      background: var(--background-color);
    }
  }

  @keyframes fade-out-bg {
    from {
      opacity: 1;
    }
    to {
      opacity: 0;
    }
  }

  &.fade-in {
    animation: fade-in-bg 0.3s ease-in;
  }
  &.fade-out {
    opacity: 0;
    animation: fade-out-bg 0.3s cubic-bezier(0.65, 0.05, 0.36, 1);
  }
}
.preview-window-initializing #slide-mode.fade-in {
  // Preview window initializes with slide mode: fade-in is undesired
  animation-duration: 0s;
}

#zoomable-image {
  position: relative;
  min-width: 224px;
  margin: auto;

  [class^='side-button'] {
    display: flex;
    align-items: center;
    position: absolute;
    top: 0;
    bottom: 0;
    opacity: 0.1;
    width: 3rem;
    transition: opacity 0.2s ease-in-out;

    // Override default button style
    border: none;
    color: #ffffffc7;
    background: transparent;
    padding: 0;

    > svg {
      width: 100%;
      height: auto;
      filter: drop-shadow(0px 3px 4px rgba(0, 0, 0, 0.5));
    }

    &:hover {
      opacity: 1;
    }
  }

  .side-button-left {
    left: 0;
  }

  .side-button-right {
    right: 0;
  }
}

#content-placeholder {
  max-width: 480px;
  margin: 10% auto auto auto;
  text-align: center;

  .divider {
    margin: auto;
    width: 60%;
    border-bottom: 1px solid var(--text-color-muted);
    margin: 1rem auto;
  }
}

.masonry {
  position: relative;
  overflow-y: auto;
  overflow-x: hidden;
  height: 100%;
  padding: 8px; // Note: keep in sync with MasonryRenderer PADDING

  [data-masonrycell] {
    position: absolute;
    transition: transform 0.2s ease;
    .thumbnail {
      // Inherit size from parent style={} attribute
      max-width: inherit;
      width: unset;
      height: inherit;
    }

    // Note: this feature has an ugly exception, when filename is also shown. See the #gallery-item[data-show-filename] rule below
    &:hover .thumbnail-tags {
      max-height: 100%;
      overflow-y: overlay; // overlay scrollbar so it doesn't push tags away

      // Hide scrollbar while tags transition upwards
      // TODO: Would be nice to have an opacity transition on the scrollbar, but can't get it to work
      animation: hide-scroll 0.25s backwards;
      @keyframes hide-scroll {
        from,
        to {
          overflow: hidden;
        }
      }
    }

    .thumbnail-tags {
      grid-area: tags;
      display: block;
      position: absolute;
      bottom: 0;
      overflow: hidden;
      transition: 0.25s $pt-transition-cubic2;
      max-height: 2.8em;
      max-width: 100%;

      > * {
        margin: 0.25em;
      }
    }

    .thumbnail-filename {
      display: block;
      background-color: rgba(0, 0, 0, 0.5);
      color: rgb(
        200,
        200,
        200
      ); // can't use --text-color: black text on black background in light theme
      width: 100%;
      height: 1.5em;
      position: absolute;
      bottom: 0;
      padding: 0.25rem;

      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;

      opacity: 0.75;
      transition: opacity 0.25s $pt-transition-cubic2;
    }

    &:hover {
      .thumbnail-filename {
        opacity: 1;
      }
    }
  }

  #invis-last-selected-item-for-scroll {
    position: absolute;
    pointer-events: none;
    z-index: -1;
  }
}

// Exception when both showing filename and tags in thumbnail overlay:
// move the tags up by the height of the filename element (23.59px)
#gallery-content[data-show-filename='true'] .masonry {
  [data-masonrycell] {
    &:hover .thumbnail-tags {
      max-height: calc(100% - 1.5em - 0.25rem);
    }
  }
  .thumbnail-tags {
    margin-bottom: calc(1.5em + 0.25rem);
  }
}
